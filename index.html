<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <title>Fail-Safe Boxing</title>
    <style>
        body { margin: 0; overflow: hidden; background: #000; font-family: monospace; color: lime; }
        #debug-panel {
            position: absolute; top: 10px; left: 10px; padding: 10px;
            background: rgba(0,0,0,0.8); border: 1px solid lime; pointer-events: none;
        }
        #center-dot {
            position: absolute; top: 50%; left: 50%; width: 10px; height: 10px;
            background: red; border-radius: 50%; transform: translate(-50%, -50%);
            pointer-events: none;
        }
    </style>
    <script type="importmap">
        {
            "imports": {
                "three": "https://unpkg.com/three@0.160.0/build/three.module.js",
                "three/addons/": "https://unpkg.com/three@0.160.0/examples/jsm/"
            }
        }
    </script>
</head>
<body>
    <div id="debug-panel">
        <strong>SİSTEM DURUMU:</strong><br>
        <span id="status-ring">Ring: Bekleniyor...</span><br>
        <span id="status-enemy">Enemy: Bekleniyor...</span><br>
        <span id="status-gloves">Gloves: Bekleniyor...</span><br>
        <br>
        <em>Oynamak için ekrana tıkla (WASD + Mouse)</em><br>
        <em>Vurmak için: Sol Tık</em>
    </div>
    <div id="center-dot"></div>

    <script type="module">
        import * as THREE from 'three';
        import { GLTFLoader } from 'three/addons/loaders/GLTFLoader.js';
        import { PointerLockControls } from 'three/addons/controls/PointerLockControls.js';

        // --- TEMEL KURULUM ---
        const scene = new THREE.Scene();
        scene.background = new THREE.Color(0x202020);
        
        const camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
        camera.position.set(0, 1.7, 3); // Biraz geriden başlatıyoruz

        const renderer = new THREE.WebGLRenderer({ antialias: true });
        renderer.setSize(window.innerWidth, window.innerHeight);
        document.body.appendChild(renderer.domElement);

        // Işıklandırma
        const light = new THREE.DirectionalLight(0xffffff, 2);
        light.position.set(5, 10, 5);
        scene.add(light);
        scene.add(new THREE.AmbientLight(0xffffff, 0.5));

        // --- YEDEK PARÇALAR (Eğer model yüklenmezse bunlar görünecek) ---
        
        // 1. Yedek Zemin (Ring gelmezse)
        const floorGeo = new THREE.PlaneGeometry(20, 20);
        const floorMat = new THREE.MeshStandardMaterial({ color: 0x333333 });
        const backupFloor = new THREE.Mesh(floorGeo, floorMat);
        backupFloor.rotation.x = -Math.PI / 2;
        scene.add(backupFloor);

        // 2. Yedek Düşman (Kırmızı Kutu)
        const enemyGeo = new THREE.BoxGeometry(1, 2, 1);
        const enemyMat = new THREE.MeshStandardMaterial({ color: 0xff0000 });
        let enemyContainer = new THREE.Mesh(enemyGeo, enemyMat);
        enemyContainer.position.set(0, 1, -3); // Karşıda
        scene.add(enemyContainer);

        // 3. Yedek Eldiven (Mavi Kutu - Kameraya bağlı)
        const gloveGeo = new THREE.BoxGeometry(0.2, 0.2, 0.2);
        const gloveMat = new THREE.MeshStandardMaterial({ color: 0x0000ff });
        let gloveContainer = new THREE.Mesh(gloveGeo, gloveMat);
        gloveContainer.position.set(0.4, -0.4, -0.5);
        camera.add(gloveContainer);
        scene.add(camera);

        // --- MODEL YÜKLEME SİSTEMİ ---
        const loader = new GLTFLoader();
        let mixer; // Animasyon oynatıcı

        function updateStatus(id, msg, color) {
            const el = document.getElementById(id);
            el.innerHTML = msg;
            el.style.color = color;
        }

        // A) RING YÜKLE
        loader.load('./Boxing Ring.glb', (gltf) => {
            scene.remove(backupFloor); // Yedek zemini sil
            const ring = gltf.scene;
            ring.position.set(0, 0, 0); 
            scene.add(ring);
            updateStatus('status-ring', 'Ring YÜKLENDİ!', '#0f0');
        }, undefined, (err) => {
            updateStatus('status-ring', 'Ring YÜKLENEMEDİ (Yedek Devrede)', 'red');
            console.error(err);
        });

        // B) DÜŞMAN (Male Fighter) YÜKLE
        loader.load('./Male Fighter.glb', (gltf) => {
            scene.remove(enemyContainer); // Kırmızı kutuyu sil
            const enemy = gltf.scene;
            enemy.position.set(0, 0, -3);
            scene.add(enemy);
            enemyContainer = enemy; // Artık düşmanımız bu model
            
            // Animasyon
            mixer = new THREE.AnimationMixer(enemy);
            if(gltf.animations.length > 0) {
                mixer.clipAction(gltf.animations[0]).play();
            }

            updateStatus('status-enemy', 'Fighter YÜKLENDİ!', '#0f0');
        }, undefined, (err) => {
            updateStatus('status-enemy', 'Fighter BULUNAMADI (Kırmızı Kutu Devrede)', 'red');
        });

        // C) ELDİVEN (Boxing Gloves) YÜKLE
        loader.load('./Boxing Gloves.glb', (gltf) => {
            camera.remove(gloveContainer); // Mavi kutuyu sil
            const gloves = gltf.scene;
            gloves.scale.set(0.1, 0.1, 0.1); // Boyut ayarı (gerekirse değiştir)
            gloves.position.set(0.4, -0.4, -0.5);
            gloves.rotation.set(0, Math.PI, 0); // Bize dönük
            
            gloveContainer = gloves;
            camera.add(gloves);
            updateStatus('status-gloves', 'Eldiven YÜKLENDİ!', '#0f0');
        }, undefined, (err) => {
            updateStatus('status-gloves', 'Eldiven BULUNAMADI (Mavi Kutu Devrede)', 'red');
        });

        // --- KONTROLLER VE OYUN DÖNGÜSÜ ---
        const controls = new PointerLockControls(camera, document.body);
        
        document.body.addEventListener('click', () => {
            controls.lock();
            // Vuruş efekti (Basit ileri git gel)
            if(gloveContainer) {
                gloveContainer.position.z -= 0.5;
                setTimeout(() => gloveContainer.position.z += 0.5, 100);
            }
        });

        // Klavye
        const keys = { w:false, a:false, s:false, d:false };
        document.addEventListener('keydown', (e) => keys[e.key.toLowerCase()] = true);
        document.addEventListener('keyup', (e) => keys[e.key.toLowerCase()] = false);

        const clock = new THREE.Clock();

        function animate() {
            requestAnimationFrame(animate);
            const delta = clock.getDelta();

            // Hareket
            if(controls.isLocked) {
                const speed = 5 * delta;
                if(keys.w) controls.moveForward(speed);
                if(keys.s) controls.moveForward(-speed);
                if(keys.a) controls.moveRight(-speed);
                if(keys.d) controls.moveRight(speed);
            }

            // Animasyon güncelle
            if(mixer) mixer.update(delta);

            renderer.render(scene, camera);
        }

        animate();

        // Ekran boyutu değişirse
        window.addEventListener('resize', () => {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        });
    </script>
</body>
</html>
