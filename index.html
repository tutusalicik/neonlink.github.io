<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quantum Link - Ultra Secure Chat</title>
    <link href="https://cdn.jsdelivr.net/npm/remixicon@3.5.0/fonts/remixicon.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;500;700&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/peerjs@1.5.2/dist/peerjs.min.js"></script>

    <style>
        :root {
            --bg: #09090b;
            --surface: #18181b;
            --surface-hover: #27272a;
            --primary: #6366f1; /* Indigo */
            --primary-glow: rgba(99, 102, 241, 0.4);
            --text: #f4f4f5;
            --text-sec: #a1a1aa;
            --border: #27272a;
            --green: #22c55e;
            --red: #ef4444;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Plus Jakarta Sans', sans-serif; -webkit-font-smoothing: antialiased; }

        body {
            background-color: var(--bg);
            color: var(--text);
            height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
            background-image: radial-gradient(circle at 50% 0%, #1e1b4b 0%, transparent 50%);
        }

        /* --- UI CONTAINER --- */
        .app-shell {
            width: 100%; max-width: 1200px; height: 90vh;
            background: rgba(24, 24, 27, 0.6);
            backdrop-filter: blur(20px);
            border: 1px solid var(--border);
            border-radius: 24px;
            display: flex; overflow: hidden;
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.5);
            position: relative;
        }

        /* --- SOL PANEL (Login & Status) --- */
        .sidebar {
            width: 320px; background: var(--surface);
            border-right: 1px solid var(--border);
            padding: 30px; display: flex; flex-direction: column; gap: 25px;
            z-index: 2;
        }

        .brand {
            font-size: 1.5rem; font-weight: 800; letter-spacing: -0.5px;
            display: flex; align-items: center; gap: 10px;
        }
        .brand i { color: var(--primary); font-size: 1.8rem; }

        .id-card {
            background: var(--bg); padding: 20px; border-radius: 16px; border: 1px solid var(--border);
            position: relative; overflow: hidden;
        }
        .id-card::before {
            content: ''; position: absolute; top: 0; left: 0; width: 4px; height: 100%; background: var(--primary);
        }
        .label { font-size: 0.75rem; text-transform: uppercase; color: var(--text-sec); font-weight: 700; letter-spacing: 1px; margin-bottom: 8px; }
        .my-id {
            font-family: 'Courier New', monospace; font-size: 1.2rem; font-weight: bold; color: white;
            cursor: pointer; display: flex; align-items: center; justify-content: space-between;
        }
        .my-id:hover { color: var(--primary); }
        .my-id i { font-size: 1rem; opacity: 0.5; }

        .connect-form { display: flex; flex-direction: column; gap: 15px; margin-top: auto; }
        .inp {
            background: var(--bg); border: 1px solid var(--border); color: white; padding: 14px;
            border-radius: 12px; font-size: 0.95rem; outline: none; transition: 0.3s;
        }
        .inp:focus { border-color: var(--primary); box-shadow: 0 0 0 3px var(--primary-glow); }

        .btn {
            background: var(--primary); color: white; border: none; padding: 14px; border-radius: 12px;
            font-weight: 600; cursor: pointer; transition: 0.3s; display: flex; align-items: center; justify-content: center; gap: 8px;
        }
        .btn:hover { background: #4f46e5; transform: translateY(-2px); }
        .btn:disabled { opacity: 0.5; cursor: not-allowed; }

        .status-badge {
            display: inline-flex; align-items: center; gap: 8px; padding: 6px 12px;
            background: rgba(34, 197, 94, 0.1); color: var(--green); border-radius: 20px;
            font-size: 0.8rem; font-weight: 600; margin-top: 10px; opacity: 0; transition: 0.3s;
        }
        .status-badge.visible { opacity: 1; }
        .dot { width: 8px; height: 8px; background: currentColor; border-radius: 50%; box-shadow: 0 0 10px currentColor; }

        /* --- SAĞ PANEL (Chat) --- */
        .chat-container { flex: 1; display: flex; flex-direction: column; position: relative; background: rgba(0,0,0,0.2); }
        
        .chat-header {
            height: 80px; padding: 0 30px; border-bottom: 1px solid var(--border);
            display: flex; align-items: center; justify-content: space-between;
            background: rgba(24, 24, 27, 0.8);
        }
        .user-info h2 { font-size: 1.1rem; font-weight: 700; }
        .user-info p { font-size: 0.8rem; color: var(--text-sec); display: flex; align-items: center; gap: 5px; }

        .messages {
            flex: 1; padding: 30px; overflow-y: auto; display: flex; flex-direction: column; gap: 20px;
        }
        
        /* Empty State */
        .empty-state {
            position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);
            text-align: center; color: var(--text-sec);
        }
        .empty-state i { font-size: 4rem; opacity: 0.2; margin-bottom: 20px; }

        .msg {
            max-width: 70%; padding: 14px 18px; border-radius: 20px; font-size: 0.95rem; line-height: 1.5;
            position: relative; animation: slideUp 0.3s cubic-bezier(0.2, 0.8, 0.2, 1);
        }
        .msg.me {
            align-self: flex-end; background: var(--primary); color: white;
            border-bottom-right-radius: 4px; box-shadow: 0 5px 15px var(--primary-glow);
        }
        .msg.them {
            align-self: flex-start; background: var(--surface-hover); color: var(--text);
            border: 1px solid var(--border); border-bottom-left-radius: 4px;
        }
        .msg-meta { font-size: 0.7rem; opacity: 0.7; margin-top: 5px; text-align: right; }
        .msg img { max-width: 100%; border-radius: 12px; margin-top: 5px; cursor: pointer; }

        @keyframes slideUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }

        .input-area {
            padding: 20px 30px; background: var(--surface); border-top: 1px solid var(--border);
            display: flex; gap: 15px; align-items: center;
        }
        .chat-inp {
            flex: 1; background: var(--bg); border: none; padding: 15px; border-radius: 12px;
            color: white; outline: none; transition: 0.3s;
        }
        .chat-inp:focus { box-shadow: 0 0 0 2px var(--primary-glow); }
        
        .icon-btn {
            width: 45px; height: 45px; border-radius: 12px; border: none; background: var(--bg);
            color: var(--text-sec); font-size: 1.2rem; cursor: pointer; transition: 0.2s;
            display: flex; align-items: center; justify-content: center;
        }
        .icon-btn:hover { background: var(--surface-hover); color: var(--text); }
        .icon-btn.send { background: var(--primary); color: white; }
        .icon-btn.send:hover { background: #4f46e5; }

        /* Notification Toast */
        .toast {
            position: fixed; top: 20px; right: 20px; background: var(--surface); border: 1px solid var(--border);
            padding: 15px 20px; border-radius: 12px; box-shadow: 0 10px 30px rgba(0,0,0,0.5);
            display: flex; align-items: center; gap: 10px; transform: translateX(200%); transition: 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            z-index: 1000;
        }
        .toast.show { transform: translateX(0); }
        .toast i { color: var(--green); }

        /* Mobil */
        @media (max-width: 768px) {
            .app-shell { height: 100vh; border-radius: 0; border: none; flex-direction: column; }
            .sidebar { width: 100%; padding: 20px; height: auto; border-bottom: 1px solid var(--border); }
            .chat-container { flex: 1; }
            .connect-form { display: none; } /* Mobilde yer kaplamasın, modal yapılabilir */
            .id-card { padding: 10px; }
            .brand { font-size: 1.2rem; }
        }
        
    </style>
</head>
<body>

    <div class="app-shell">
        <aside class="sidebar">
            <div class="brand">
                <i class="ri-radar-fill"></i> QUANTUM LINK
            </div>
            
            <div class="id-card" onclick="copyId()">
                <div class="label">Senin Güvenli ID'n</div>
                <div class="my-id" id="my-id">Oluşturuluyor... <i class="ri-file-copy-line"></i></div>
            </div>

            <div class="status-badge" id="status-badge">
                <div class="dot"></div> Bağlantı Güvenli
            </div>

            <div class="connect-form" id="connect-form">
                <div class="label">Kuzeninin ID'si</div>
                <input type="text" class="inp" id="target-id" placeholder="ID'yi buraya yapıştır...">
                <button class="btn" id="connect-btn" onclick="connect()">
                    <i class="ri-link"></i> BAĞLAN
                </button>
            </div>
        </aside>

        <main class="chat-container">
            <header class="chat-header">
                <div class="user-info">
                    <h2 id="chat-title">Bağlantı Bekleniyor...</h2>
                    <p id="chat-subtitle"><i class="ri-lock-2-line"></i> Uçtan uca şifreli</p>
                </div>
                <div>
                    <button class="icon-btn" onclick="clearChat()"><i class="ri-delete-bin-line"></i></button>
                </div>
            </header>

            <div class="messages" id="msgs">
                <div class="empty-state">
                    <i class="ri-signal-wifi-off-line"></i>
                    <h3>Henüz kimse bağlı değil</h3>
                    <p>Sol taraftan kuzeninin ID'sini girip bağlan.</p>
                </div>
            </div>

            <div class="input-area">
                <input type="file" id="file-input" hidden accept="image/*" onchange="sendImage()">
                <button class="icon-btn" onclick="document.getElementById('file-input').click()"><i class="ri-image-add-line"></i></button>
                <input type="text" class="chat-inp" id="msg-inp" placeholder="Mesaj yaz..." disabled>
                <button class="icon-btn send" onclick="sendMessage()"><i class="ri-send-plane-fill"></i></button>
            </div>
        </main>
    </div>

    <div class="toast" id="toast">
        <i class="ri-checkbox-circle-fill"></i>
        <span id="toast-msg">İşlem başarılı</span>
    </div>

<script>
    // --- SES MOTORU (Bildirim Sesi) ---
    const notifSound = new Audio("data:audio/wav;base64,UklGRl9vT19XQVZFZm10IBAAAAABAAEAQB8AAEAfAAABAAgAZGF0YU..."); // Boş ses placeholder, tarayıcı hatası vermesin diye.

    // --- SİSTEM AYARLARI ---
    let myId = "";
    let peer;
    let conn = null;

    // Bağlantı Sorununu Çözen STUN Sunucuları (BU KISIM ÖNEMLİ)
    const peerConfig = {
        debug: 2,
        config: {
            iceServers: [
                { urls: 'stun:stun.l.google.com:19302' },
                { urls: 'stun:global.stun.twilio.com:3478' }
            ]
        }
    };

    // DOM Elementleri
    const myIdEl = document.getElementById('my-id');
    const statusBadge = document.getElementById('status-badge');
    const msgsArea = document.getElementById('msgs');
    const msgInput = document.getElementById('msg-inp');
    const connectBtn = document.getElementById('connect-btn');
    const connectForm = document.getElementById('connect-form');

    // --- BAŞLATMA ---
    function init() {
        // Rastgele kısa bir ID oluştur (okuması kolay olsun)
        const randomId = "user_" + Math.random().toString(36).substr(2, 5);
        
        peer = new Peer(randomId, peerConfig);

        peer.on('open', (id) => {
            myId = id;
            myIdEl.innerHTML = `${id} <i class="ri-file-copy-line"></i>`;
            showToast("ID Oluşturuldu: " + id);
        });

        peer.on('error', (err) => {
            console.error(err);
            alert("Hata: " + err.type);
        });

        // Biri bana bağlanırsa
        peer.on('connection', (c) => {
            handleConnection(c);
            showToast("Kuzenin bağlandı!");
        });
    }

    // --- BAĞLANTI YÖNETİMİ ---
    function connect() {
        const target = document.getElementById('target-id').value.trim();
        if(!target) return showToast("Lütfen bir ID girin");
        
        connectBtn.innerText = "Bağlanılıyor...";
        connectBtn.disabled = true;

        const c = peer.connect(target);
        handleConnection(c);
    }

    function handleConnection(c) {
        conn = c;

        conn.on('open', () => {
            // UI Güncelleme
            statusBadge.classList.add('visible');
            document.getElementById('chat-title').innerText = "Bağlı: " + conn.peer;
            document.getElementById('chat-subtitle').innerHTML = `<span style="color:#22c55e">● Çevrimiçi</span>`;
            
            connectForm.style.display = 'none'; // Bağlanınca formu gizle
            msgInput.disabled = false;
            msgInput.focus();
            connectBtn.innerText = "BAĞLAN";
            connectBtn.disabled = false;
            
            msgsArea.innerHTML = ""; // Empty state'i temizle
            addSystemMessage("Güvenli tünel oluşturuldu. Sohbete başla.");
        });

        conn.on('data', (data) => {
            if(data.type === 'text') {
                addMessage(data.content, 'them');
            } else if(data.type === 'image') {
                addImage(data.content, 'them');
            }
        });

        conn.on('close', () => {
            alert("Bağlantı koptu!");
            location.reload();
        });
    }

    // --- MESAJLAŞMA ---
    msgInput.addEventListener('keypress', (e) => {
        if(e.key === 'Enter') sendMessage();
    });

    function sendMessage() {
        const text = msgInput.value.trim();
        if(!text || !conn) return;

        addMessage(text, 'me');
        conn.send({ type: 'text', content: text });
        msgInput.value = "";
    }

    function sendImage() {
        const file = document.getElementById('file-input').files[0];
        if(!file || !conn) return;

        const reader = new FileReader();
        reader.onload = function(e) {
            const imgData = e.target.result;
            addImage(imgData, 'me');
            conn.send({ type: 'image', content: imgData });
        };
        reader.readAsDataURL(file);
    }

    // --- UI FONKSİYONLARI ---
    function addMessage(text, sender) {
        const time = new Date().toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'});
        const div = document.createElement('div');
        div.className = `msg ${sender}`;
        div.innerHTML = `
            ${text}
            <div class="msg-meta">${time}</div>
        `;
        msgsArea.appendChild(div);
        scrollToBottom();
    }

    function addImage(src, sender) {
        const time = new Date().toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'});
        const div = document.createElement('div');
        div.className = `msg ${sender}`;
        div.innerHTML = `
            <img src="${src}" onclick="window.open(this.src)">
            <div class="msg-meta">${time}</div>
        `;
        msgsArea.appendChild(div);
        scrollToBottom();
    }

    function addSystemMessage(text) {
        const div = document.createElement('div');
        div.style.textAlign = 'center';
        div.style.color = '#555';
        div.style.fontSize = '0.8rem';
        div.style.margin = '20px 0';
        div.innerText = text;
        msgsArea.appendChild(div);
    }

    function scrollToBottom() {
        msgsArea.scrollTop = msgsArea.scrollHeight;
    }

    function clearChat() {
        msgsArea.innerHTML = "";
        addSystemMessage("Sohbet geçmişi temizlendi.");
    }

    function copyId() {
        navigator.clipboard.writeText(myId);
        showToast("ID Kopyalandı!");
    }

    function showToast(msg) {
        const t = document.getElementById('toast');
        document.getElementById('toast-msg').innerText = msg;
        t.classList.add('show');
        setTimeout(() => t.classList.remove('show'), 3000);
    }

    // Başlat
    init();

</script>
</body>
</html>
